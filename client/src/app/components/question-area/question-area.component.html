<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<app-chat *ngIf="context != 'testPage'"></app-chat>
<div id="main-container">
    <button mat-raised-button id="exit-button" routerLink="/home" (click)="handleQuit()">QUITTER</button>
    <div id="question-area">
        <div id="question-timer-area">
            <div
                id="score-feedback-area"
                *ngIf="(showFeedback && context !== 'playerView' && !isCooldown) || (showFeedback && context === 'testPage'); else elseBlock"
            >
                <h1 id="score">SCORE : {{ playerScore }}</h1>
                <h1 class="points" id="right-answer" *ngIf="bonus > 0 && isRightAnswer">
                    âœ¨Bonne RÃ©ponse! Vous avez obtenu {{ currentQuestion.points }} points et un bonus de {{ bonus }} points!âœ¨
                </h1>
                <h1 class="points" id="right-answer" *ngIf="bonus == 0 && isRightAnswer">
                    âœ¨Bonne RÃ©ponse! Vous avez obtenu {{ currentQuestion.points }} points et un bonus de {{ bonus }} points!âœ¨
                </h1>
                <h1 class="points" id="wrong-answer" *ngIf="!isRightAnswer">ðŸ˜”Mauvaise RÃ©ponseðŸ˜”</h1>
            </div>

            <ng-template #elseBlock>
                <div id="score-area" *ngIf="context !== 'hostView'">
                    <h1 id="score">
                        SCORE :
                        {{ playerScore }}
                    </h1>
                </div>
            </ng-template>

            <!-- TODO: remove the ! -->
            <div id="question">
                <div id="question-text-container">
                    <h1>{{ this.currentQuestion!.text }}</h1>
                </div>
                <h1 id="points">{{ currentQuestion.points }} points</h1>
            </div>

            <div id="timer-area">
                <mat-progress-spinner [value]="computeTimerProgress()" mode="determinate" diameter="90"> </mat-progress-spinner>
                <h2 id="time-left">
                    {{ time }}
                </h2>
            </div>
        </div>

        <div id="choice-area" *ngIf="context === 'testPage' || (context === 'playerView' && !isCooldown)">
            <button
                mat-raised-button
                *ngFor="let choice of currentQuestion.choices; let i = index"
                class="answer"
                [class.selected]="isSelected(choice) && !showFeedback"
                [class.correct]="showFeedback && isCorrectAnswer(choice)"
                [class.incorrect]="showFeedback && !isCorrectAnswer(choice) && isSelected(choice)"
                (click)="selectChoice(choice)"
            >
                <p>{{ i + 1 }}. {{ choice.text }}</p>
            </button>
        </div>
        <div id="host-area" *ngIf="context === 'hostView'">
            <div class="histogram-container">
                <!-- <app-histogram></app-histogram> -->
                <!-- TODO: a revoir quand l'histogramme est fait -->
            </div>
            <div id="buttons-container">
                <button mat-raised-button>PrÃ©senter les rÃ©sultats finaux</button>
                <button mat-raised-button color="primary" (click)="nextQuestion()" *ngIf="showFeedback">Question suivante</button>
            </div>
        </div>
        <div id="submit-button-container" *ngIf="context === 'testPage' || context === 'playerView'">
            <button mat-raised-button color="primary" id="submit-button" *ngIf="isSelectionEnabled" (click)="submitAnswers()">SOUMETTRE</button>
        </div>
    </div>
</div>
<app-players-list [players]="this.players" *ngIf="context === 'playerView' || context === 'hostView'"></app-players-list>
